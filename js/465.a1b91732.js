"use strict";(self["webpackChunkTrendBook"]=self["webpackChunkTrendBook"]||[]).push([[465],{2048:function(t,e,s){s.d(e,{Z:function(){return g}});var i=s(6252),o=s(3577);const a={class:"d-flex mb-3"},l={key:0,class:"tag-block d-flex align-items-center me-3 bg-light"};function n(t,e,s,n,r,d){return(0,i.wg)(),(0,i.iD)("div",a,[s.isSinglePost?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("i",{onClick:e[0]||(e[0]=e=>t.$router.go(-1)),class:"bi bi-arrow-left-square icons-item ms-3 me-3"})])),(0,i._)("div",{class:(0,o.C_)(["tag-block d-flex align-items-center w-100 bg-light",s.isSinglePost?"justify-content-center":""])},[(0,i._)("h2",{class:(0,o.C_)(s.isSinglePost?"text-center":"ps-3")},(0,o.zw)(s.tagText),3)],2)])}var r={props:{tagText:String,isSinglePost:{type:Boolean,default:!0}},data(){return{}},methods:{},mounted(){}},d=s(3744);const c=(0,d.Z)(r,[["render",n],["__scopeId","data-v-39ef2338"]]);var g=c},777:function(t,e,s){s.r(e),s.d(e,{default:function(){return ut}});var i=s(6252);const o={class:"row"},a={class:"col-xl-8 col-md-12"},l={class:"col"};function n(t,e,s,n,r,d){const c=(0,i.up)("AlertView"),g=(0,i.up)("TagView"),p=(0,i.up)("postCardlView"),m=(0,i.up)("ItemView");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",a,[r.allPost.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(c,{key:0,tagText:"資料載入中..."},null,8,["tagText"])),r.allPost.length?((0,i.wg)(),(0,i.j4)(g,{key:1,tagText:`[${r.allPost[0].type}] ${r.allPost[0].title}`,isSinglePost:!1},null,8,["tagText"])):(0,i.kq)("",!0),(0,i.Wm)(p,{postData:r.allPost,loading:r.loading,onGetSinglePost:d.getPost},null,8,["postData","loading","onGetSinglePost"])]),(0,i._)("div",l,[(0,i.Wm)(m,{modalTitle:"回覆貼文",onGetPostData:d.getPost},null,8,["onGetPostData"])])])}var r=s(3577),d=s(9963);const c=t=>((0,i.dD)("data-v-079a90a7"),t=t(),(0,i.Cn)(),t),g={class:"lodingBlock"},p={key:0,class:"spinner-border mx-auto text-light",style:{"font-size":"0.5rem"},role:"status"},m=c((()=>(0,i._)("span",{class:"visually-hidden"},"Loading...",-1))),u=[m],h={class:"card bg-light p-4 mb-3"},k={class:"card-user d-flex"},w={class:"card-user-icon font-customize-style"},_=["src"],f={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},b={class:"ms-3"},v={class:"font-customize-style"},D={class:"card-user-date"},y={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},$={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},x=["onClick"],L={class:"mt-4"},P={class:"font-customize-style"},C={class:"mt-3"},z=["src"],q={class:"d-flex mt-3"},A={class:"card-good-icon"},T=["onClick"],I=["onClick"],H={key:0,class:"card-good-text ms-2 mt-2"},S={key:0,class:"card-good-text ms-2 mt-2"},V={key:1,class:"spinner-border spinner-border-sm mt-2 ms-auto",role:"status"},M={class:"card-user d-flex"},Y={class:"card-user-icon font-customize-style"},Z=["src"],B={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},E={class:"ms-3"},W={class:"font-customize-style"},j={class:"card-user-date"},G={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},K={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},N=["onClick"],F={class:"card-content mt-4"},O={class:"font-customize-style"},U={class:"mt-3"},J=["src"],Q={class:"d-flex mt-3"},R={class:"card-good-icon"},X=["onClick"],tt=["onClick"],et={key:0,class:"card-good-text ms-2 mt-2"},st={key:0,class:"card-good-text ms-2 mt-2"},it={key:1,class:"spinner-border spinner-border-sm mt-2 ms-auto",role:"status"};function ot(t,e,s,o,a,l){const n=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",g,[s.loading?((0,i.wg)(),(0,i.iD)("div",p,u)):(0,i.kq)("",!0)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.postData,(e=>((0,i.wg)(),(0,i.iD)(i.HY,{key:e._id},[(0,i._)("div",h,[(0,i._)("div",k,[(0,i._)("div",w,[(0,i.Wm)(n,{to:`/user/${e.user._id}`,href:"#"},{default:(0,i.w5)((()=>[e.user.image?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.user.image,alt:""},null,8,_)):((0,i.wg)(),(0,i.iD)("img",f))])),_:2},1032,["to"])]),(0,i._)("div",b,[(0,i.Wm)(n,{to:`/user/${e.user._id}`,href:"#"},{default:(0,i.w5)((()=>[(0,i._)("p",v,(0,r.zw)(e.user.name),1)])),_:2},1032,["to"]),(0,i._)("p",D,(0,r.zw)(l.formatDate(e.createdAt)),1)]),t.$store.state.userInfo._id===e.user._id||"1"===t.$store.state.userInfo.auth?((0,i.wg)(),(0,i.iD)("i",y)):(0,i.kq)("",!0),(0,i._)("ul",$,[(0,i._)("li",null,[(0,i._)("a",{class:"dropdown-item",href:"#",onClick:(0,d.iM)((t=>l.deletePost(e)),["prevent"])},"刪除貼文",8,x)])])]),(0,i._)("div",L,[(0,i._)("div",P,(0,r.zw)(e.content),1),(0,i._)("div",C,[e.image?((0,i.wg)(),(0,i.iD)("img",{key:0,class:"card-content-img",src:e.image,alt:""},null,8,z)):(0,i.kq)("",!0)])]),(0,i._)("div",q,[(0,i._)("div",A,[-1===e.likes.findIndex((e=>e._id===t.$store.state.userInfo._id))||0===e.likes.length?((0,i.wg)(),(0,i.iD)("i",{key:0,class:"bi bi-heart icons-item",onClick:t=>l.setLike(e,"like")},null,8,T)):((0,i.wg)(),(0,i.iD)("i",{key:1,class:"bi bi-heart-fill icons-item",onClick:t=>l.clearLike(e,"like")},null,8,I))]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.likes,((t,e)=>((0,i.wg)(),(0,i.iD)(i.HY,{key:t.id},[e<2?((0,i.wg)(),(0,i.iD)("p",H,(0,r.zw)(`${t.name},`),1)):(0,i.kq)("",!0)],64)))),128)),e.likes.length>2?((0,i.wg)(),(0,i.iD)("p",S,(0,r.zw)(`...${e.likes.length}人`),1)):(0,i.kq)("",!0),a.propsLoading?((0,i.wg)(),(0,i.iD)("div",V)):(0,i.kq)("",!0)])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.comments,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"card p-4 mb-3",key:e._id},[(0,i._)("div",M,[(0,i._)("div",Y,[(0,i.Wm)(n,{to:`/user/${e.user._id}`,href:"#"},{default:(0,i.w5)((()=>[e.user.image?((0,i.wg)(),(0,i.iD)("img",{key:0,src:e.user.image,alt:""},null,8,Z)):((0,i.wg)(),(0,i.iD)("img",B))])),_:2},1032,["to"])]),(0,i._)("div",E,[(0,i.Wm)(n,{to:`/user/${e.user._id}`,href:"#"},{default:(0,i.w5)((()=>[(0,i._)("p",W,(0,r.zw)(e.user.name),1)])),_:2},1032,["to"]),(0,i._)("p",j,(0,r.zw)(l.formatDate(e.createdAt)),1)]),t.$store.state.userInfo._id===e.user._id||"1"===t.$store.state.userInfo.auth?((0,i.wg)(),(0,i.iD)("i",G)):(0,i.kq)("",!0),(0,i._)("ul",K,[(0,i._)("li",null,[(0,i._)("a",{class:"dropdown-item",href:"#",onClick:(0,d.iM)((t=>l.deleteComment(e)),["prevent"])},"刪除留言",8,N)])])]),(0,i._)("div",F,[(0,i._)("div",O,(0,r.zw)(e.comment),1),(0,i._)("div",U,[e.image?((0,i.wg)(),(0,i.iD)("img",{key:0,class:"card-content-img",src:e.image,alt:""},null,8,J)):(0,i.kq)("",!0)])]),(0,i._)("div",Q,[(0,i._)("div",R,[-1===e.likes.findIndex((e=>e._id===t.$store.state.userInfo._id))||0===e.likes.length?((0,i.wg)(),(0,i.iD)("i",{key:0,class:"bi bi-heart icons-item",onClick:t=>l.setLike(e,"commentLikes")},null,8,X)):((0,i.wg)(),(0,i.iD)("i",{key:1,class:"bi bi-heart-fill icons-item",onClick:t=>l.clearLike(e,"commentLikes")},null,8,tt))]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.likes,((t,e)=>((0,i.wg)(),(0,i.iD)(i.HY,{key:t.id},[e<2?((0,i.wg)(),(0,i.iD)("p",et,(0,r.zw)(t.name)+",",1)):(0,i.kq)("",!0)],64)))),128)),e.likes.length>2?((0,i.wg)(),(0,i.iD)("p",st,(0,r.zw)(`...${e.likes.length}人`),1)):(0,i.kq)("",!0),a.propsLoading?((0,i.wg)(),(0,i.iD)("div",it)):(0,i.kq)("",!0)])])))),128))],64)))),128))])}var at={props:{postData:{type:Object,default(){return{}}},loading:{type:Boolean}},emits:["get-single-post"],data(){return{propsLoading:!1,postBlock:!1,fromData:{comment:null},isEdit:!1}},methods:{getAllpost(t,e){this.$emit("get-single-post",t,e)},postComment(t){this.propsLoading=!0;const e=this.fromData;this.axios.post(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`,e).then((()=>{this.getAllpost(),this.fromData.comment=null,this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("傳送失敗")}))},setLike(t,e){this.propsLoading=!0,this.axios.post(`https://trend-book-api.herokuapp.com/post/${t._id}/${e}`).then((()=>{this.getAllpost(),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("按讚失敗")}))},clearLike(t,e){this.propsLoading=!0,e="like"===e?"unlike":"commentUnlike",this.axios.delete(`https://trend-book-api.herokuapp.com/post/${t._id}/${e}`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("收回失敗")}))},formatDate(t){const e=new Date(t),s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`;return s},deletePost(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/posts/${t._id}`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},deleteComment(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},updataComment(t){const e={comment:t.comment};this.isEdit=!0,this.axios.patch(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`,e).then((()=>{this.getAllpost(),this.isEdit=!1})).catch((()=>{this.isEdit=!1,alert("傳送失敗")}))}},mounted(){}},lt=s(3744);const nt=(0,lt.Z)(at,[["render",ot],["__scopeId","data-v-079a90a7"]]);var rt=nt,dt=s(1158),ct=s(2048),gt=s(8384),pt={components:{postCardlView:rt,ItemView:dt.Z,TagView:ct.Z,AlertView:gt.Z},data(){return{allPost:[],loading:null}},methods:{getAllPost(t="-createdAt",e="",s=1,i=!1){if(this.loading)return;this.loading=!0;const o={sort:`?timeSort=${t}`,search:`&q=${e}`,page:`&page=${s}`};this.axios.get(`https://trend-book-api.herokuapp.com/posts${o.sort}${o.search}${o.page}`).then((t=>{if(i){t.data.data.length||window.removeEventListener("scroll",this.scrollEvent),this.page+=1;const e=this.allPost.concat(t.data.data);this.allPost=e}else this.allPost=t.data.data,this.page=2;this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getAllPost")}))},getPost(){this.loading=!0,this.axios.get(`https://trend-book-api.herokuapp.com/posts/${this.$route.params.id}`).then((t=>{this.allPost=t.data.data,this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getAllPost")}))}},mounted(){this.getPost()}};const mt=(0,lt.Z)(pt,[["render",n]]);var ut=mt}}]);
//# sourceMappingURL=465.a1b91732.js.map
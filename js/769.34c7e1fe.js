"use strict";(self["webpackChunkTrendBook"]=self["webpackChunkTrendBook"]||[]).push([[769],{9765:function(t,s,e){e.d(s,{Z:function(){return F}});var o=e(6252),i=e(3577),l=e(9963);const a=t=>((0,o.dD)("data-v-f4e207c8"),t=t(),(0,o.Cn)(),t),n={class:"lodingBlock"},r={key:0,class:"spinner-border mx-auto text-light",style:{"font-size":"0.5rem"},role:"status"},d=a((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),c=[d],p={class:"card-user d-flex"},h={class:"card-user-icon font-customize-style"},u=["src"],g={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},m={class:"d-flex ms-3 mt-2"},f={class:"card-user-date ms-3"},w={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},k={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},b=["onClick"],_={class:"d-flex justify-content-between mt-3 hover"},v={class:"d-flex pe-2"},y={class:"d-flex"},D={class:"font-customize-style fs-5"},$={class:"font-customize-style fs-5 ps-2"},P={class:"p-1 mt-3"},x={key:0,class:"fw-light"},L={key:1,class:"fw-light"},z=["src"],C={class:"d-flex mt-3"},E=a((()=>(0,o._)("i",{class:"bi bi-heart-fill icons-heart"},null,-1))),A={class:"ms-2"},I=a((()=>(0,o._)("i",{class:"bi bi-chat-dots-fill icons-heart ms-4"},null,-1))),q={class:"ms-2"},T={class:"lodingBlock mt-3"},V={key:0,class:"spinner-border mx-auto text-light",style:{"font-size":"0.5rem"},role:"status"},U=a((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),H=[U];function M(t,s,e,a,d,U){const M=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",n,[e.loading?((0,o.wg)(),(0,o.iD)("div",r,c)):(0,o.kq)("",!0)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.postData,(s=>((0,o.wg)(),(0,o.iD)(o.HY,null,[t.$store.state.userInfo?((0,o.wg)(),(0,o.iD)("div",{class:"card bg-light p-4 mb-3",key:s._id},[(0,o._)("div",p,[(0,o._)("div",h,[(0,o.Wm)(M,{to:`/user/${s.user._id}`,href:"#"},{default:(0,o.w5)((()=>[s.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.user.image,alt:""},null,8,u)):((0,o.wg)(),(0,o.iD)("img",g))])),_:2},1032,["to"])]),(0,o._)("div",m,[(0,o._)("p",null,(0,i.zw)(s.user.name),1),(0,o._)("p",f,(0,i.zw)(U.formatDate(s.createdAt)),1)]),t.$store.state.userInfo._id===s.user._id||"1"===t.$store.state.userInfo.auth?((0,o.wg)(),(0,o.iD)("i",w)):(0,o.kq)("",!0),(0,o._)("ul",k,[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:(0,l.iM)((t=>U.deletePost(s)),["prevent"])},"刪除貼文",8,b)])])]),(0,o.Wm)(M,{to:`/post/${s._id}`,href:"#"},{default:(0,o.w5)((()=>[(0,o._)("div",_,[(0,o._)("div",v,[(0,o._)("div",null,[(0,o._)("div",y,[(0,o._)("h3",D,"["+(0,i.zw)(s.type)+"]",1),(0,o._)("p",$,(0,i.zw)(s.title),1)]),(0,o._)("div",P,[s.content.length>50?((0,o.wg)(),(0,o.iD)("p",x,(0,i.zw)(s.content.substring(0,50))+"...",1)):((0,o.wg)(),(0,o.iD)("p",L,(0,i.zw)(s.content),1))])])]),s.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.image,alt:""},null,8,z)):(0,o.kq)("",!0)]),(0,o._)("div",C,[E,(0,o._)("p",A,(0,i.zw)(s.likes.length),1),I,(0,o._)("p",q,(0,i.zw)(s.comments.length),1)])])),_:2},1032,["to"])])):(0,o.kq)("",!0)],64)))),256)),(0,o._)("div",T,[e.loading&&e.postData.length?((0,o.wg)(),(0,o.iD)("div",V,H)):(0,o.kq)("",!0)])])}var Z={props:{postData:{type:Object,default(){return{}}},loading:{type:Boolean}},emits:["get-all-post"],data(){return{propsLoading:!1,fromData:{comment:null},isEdit:!1}},methods:{getAllpost(t,s){this.$emit("get-all-post",t,s)},postComment(t){this.propsLoading=!0;const s=this.fromData;this.axios.post(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`,s).then((()=>{this.getAllpost(),this.fromData.comment=null,this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("傳送失敗")}))},setLike(t){const s=t.likes.find((t=>t.name===this.$store.state.userInfo.name));s?this.clearLike(t):(this.propsLoading=!0,this.axios.post(`https://trend-book-api.herokuapp.com/post/${t._id}/like`).then((()=>{this.getAllpost(),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("按讚失敗")})))},clearLike(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/post/${t._id}/unlike`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("收回失敗")}))},formatDate(t){const s=new Date(t),e=`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()} ${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`;return e},deletePost(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/posts/${t._id}`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},deleteComment(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},updataComment(t){const s={comment:t.comment};this.isEdit=!0,this.axios.patch(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`,s).then((()=>{this.getAllpost(),this.isEdit=!1})).catch((()=>{this.isEdit=!1,alert("傳送失敗")}))},editComment(t){t.isEdit=!0}},mounted(){}},B=e(3744);const j=(0,B.Z)(Z,[["render",M],["__scopeId","data-v-f4e207c8"]]);var F=j},5101:function(t,s,e){e.r(s),e.d(s,{default:function(){return q}});var o=e(6252),i=e(3577),l=e(9963);const a=t=>((0,o.dD)("data-v-c0805b60"),t=t(),(0,o.Cn)(),t),n={class:"row"},r={class:"col-xl-8 col-md-12"},d={key:0,class:"follow-block d-flex align-items-center bg-light mb-3"},c=["src"],p={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},h={class:"follow-block-data ms-2 me-4"},u={class:"font-customize-style"},g={class:"mt-2"},m={key:2,class:"ms-auto"},f={class:"row"},w={class:"col-xl-6 col-md-12 mb-3"},k=a((()=>(0,o._)("option",{value:""},"最新貼文",-1))),b=a((()=>(0,o._)("option",{value:"asc"},"最舊貼文",-1))),_=[k,b],v={class:"col-xl-6 col-md-12 mb-3"},y={class:"input-group"},D=a((()=>(0,o._)("i",{class:"bi bi-search",style:{"font-size":"1.7rem"}},null,-1))),$=[D],P={class:"col"};function x(t,s,e,a,k,b){const D=(0,o.up)("AlertView"),x=(0,o.up)("postsCardlView"),L=(0,o.up)("ItemView");return(0,o.wg)(),(0,o.iD)("div",n,[(0,o._)("div",r,[k.user&&t.$store.state.userInfo?((0,o.wg)(),(0,o.iD)("div",d,[k.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:k.user.image,alt:""},null,8,c)):((0,o.wg)(),(0,o.iD)("img",p)),(0,o._)("div",h,[(0,o._)("h6",u,(0,i.zw)(k.user.name),1),(0,o._)("p",g,(0,i.zw)(k.user.followers.length)+"人追蹤",1)]),k.user._id!==t.$store.state.userInfo._id?((0,o.wg)(),(0,o.iD)("div",m,[-1===k.isFollow?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:s[0]||(s[0]=(...t)=>b.follow&&b.follow(...t)),class:"btn btn-primary btn-customize me-3"}," 追蹤 ")):((0,o.wg)(),(0,o.iD)("button",{key:1,onClick:s[1]||(s[1]=(...t)=>b.unfollow&&b.unfollow(...t)),class:"btn btn-primary btn-customize me-3"}," 取消追蹤 "))])):(0,o.kq)("",!0)])):(0,o.kq)("",!0),(0,o._)("div",f,[(0,o._)("div",w,[(0,o.wy)((0,o._)("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":s[2]||(s[2]=t=>k.filter=t),onChange:s[3]||(s[3]=t=>b.getPost(k.filter,k.searchPost))},_,544),[[l.bM,k.filter]])]),(0,o._)("div",v,[(0,o._)("div",y,[(0,o.wy)((0,o._)("input",{type:"text",class:"form-control border-0 pt-2 pb-2",placeholder:"搜尋貼文","aria-label":"搜尋貼文","aria-describedby":"button-addon2","onUpdate:modelValue":s[4]||(s[4]=t=>k.searchPost=t),onKeyup:s[5]||(s[5]=(0,l.D2)((t=>b.getPost(k.filter,k.searchPost)),["enter"]))},null,544),[[l.nr,k.searchPost]]),(0,o._)("button",{class:"border-0 text-light bg-primary",onClick:s[6]||(s[6]=t=>b.getPost(k.filter,k.searchPost))},$)])])]),k.loading?((0,o.wg)(),(0,o.j4)(D,{key:1,tagText:"資料載入中..."},null,8,["tagText"])):(0,o.kq)("",!0),k.loading||k.allPost.length?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(D,{key:2,tagText:"目前尚無動態"})),(0,o.Wm)(x,{postData:k.allPost,loading:k.loading,onGetAllPost:b.getPost},null,8,["postData","loading","onGetAllPost"])]),(0,o._)("div",P,[(0,o.Wm)(L,{modalTitle:"發表貼文",onGetPostData:b.getPost},null,8,["onGetPostData"])])])}var L=e(9765),z=e(1158),C=e(8384),E={components:{postsCardlView:L.Z,ItemView:z.Z,AlertView:C.Z},data(){return{searchPost:"",filter:"",allPost:[],loading:null,user:null,isFollow:!1,page:2,scrollEvent:null}},methods:{getPost(t="-createdAt",s="",e=1,o=!1){if(this.loading)return;this.loading=!0;const i={sort:`?timeSort=${t}`,search:`&q=${s}`,page:`&page=${e}`};this.axios.get(`https://trend-book-api.herokuapp.com/post/user/${this.$route.params.id}${i.sort}${i.search}${i.page}`).then((t=>{if(o){t.data.data.length||window.removeEventListener("scroll",this.scrollEvent),this.page+=1;const s=this.allPost.concat(t.data.data);this.allPost=s}else this.allPost=t.data.data,this.page=2;this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getPost")}))},getUser(){this.axios.get(`https://trend-book-api.herokuapp.com/users/${this.$route.params.id}`).then((t=>{this.user=t.data.data,this.isFollow=this.user.followers.findIndex((t=>t.user._id===this.$store.state.userInfo._id))})).catch((t=>{console.log(t,"getUser")}))},follow(){this.axios.post(`https://trend-book-api.herokuapp.com/users/${this.$route.params.id}/follow`).then((t=>{this.getPost(),this.getUser(),console.log(t,"follow")})).catch((t=>{console.log(t.response.data.message,"follow"),alert(t.response.data.message)}))},unfollow(){this.axios.delete(`https://trend-book-api.herokuapp.com/users/${this.$route.params.id}/unfollow`).then((()=>{this.getPost(),this.getUser()})).catch((t=>{console.log(t,"unfollow")}))},buildThrottle(){function t(t,s){let e=0;return function(...o){const i=Date.now();i-e>s&&(e=i,t.apply(this,o))}}const s=t(this.getPost,1e3);this.scrollEvent=()=>{const t=window.scrollY+window.innerHeight>=document.body.offsetHeight-100;t&&s(this.filter,this.searchPost,this.page,!0)}},buildScrollEvent(){this.buildThrottle(),window.addEventListener("scroll",this.scrollEvent)}},mounted(){this.getPost(),this.getUser(),this.buildScrollEvent()},beforeUnmount(){window.removeEventListener("scroll",this.scrollEvent)},watch:{$route(){"single-user"===this.$route.name&&(this.getPost(),this.getUser())}}},A=e(3744);const I=(0,A.Z)(E,[["render",x],["__scopeId","data-v-c0805b60"]]);var q=I}}]);
//# sourceMappingURL=769.34c7e1fe.js.map
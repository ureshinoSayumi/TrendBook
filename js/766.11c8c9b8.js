"use strict";(self["webpackChunkTrendBook"]=self["webpackChunkTrendBook"]||[]).push([[766],{9765:function(t,s,e){e.d(s,{Z:function(){return W}});var o=e(6252),l=e(3577),i=e(9963);const a=t=>((0,o.dD)("data-v-f4e207c8"),t=t(),(0,o.Cn)(),t),n={class:"lodingBlock"},r={key:0,class:"spinner-border mx-auto text-light",style:{"font-size":"0.5rem"},role:"status"},d=a((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),c=[d],p={class:"card-user d-flex"},h={class:"card-user-icon font-customize-style"},g=["src"],u={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},m={class:"d-flex ms-3 mt-2"},f={class:"card-user-date ms-3"},w={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},k={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},_=["onClick"],v={class:"d-flex justify-content-between mt-3 hover"},b={class:"d-flex pe-2"},P={class:"d-flex"},D={class:"font-customize-style fs-5"},y={class:"font-customize-style fs-5 ps-2"},$={class:"p-1 mt-3"},x={key:0,class:"fw-light"},L={key:1,class:"fw-light"},A=["src"],E={class:"d-flex mt-3"},z=a((()=>(0,o._)("i",{class:"bi bi-heart-fill icons-heart"},null,-1))),C={class:"ms-2"},V=a((()=>(0,o._)("i",{class:"bi bi-chat-dots-fill icons-heart ms-4"},null,-1))),I={class:"ms-2"},T={class:"lodingBlock mt-3"},q={key:0,class:"spinner-border mx-auto text-light",style:{"font-size":"0.5rem"},role:"status"},H=a((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),M=[H];function Z(t,s,e,a,d,H){const Z=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",n,[e.loading?((0,o.wg)(),(0,o.iD)("div",r,c)):(0,o.kq)("",!0)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.postData,(s=>((0,o.wg)(),(0,o.iD)(o.HY,null,[t.$store.state.userInfo?((0,o.wg)(),(0,o.iD)("div",{class:"card bg-light p-4 mb-3",key:s._id},[(0,o._)("div",p,[(0,o._)("div",h,[(0,o.Wm)(Z,{to:`/user/${s.user._id}`,href:"#"},{default:(0,o.w5)((()=>[s.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.user.image,alt:""},null,8,g)):((0,o.wg)(),(0,o.iD)("img",u))])),_:2},1032,["to"])]),(0,o._)("div",m,[(0,o._)("p",null,(0,l.zw)(s.user.name),1),(0,o._)("p",f,(0,l.zw)(H.formatDate(s.createdAt)),1)]),t.$store.state.userInfo._id===s.user._id||"1"===t.$store.state.userInfo.auth?((0,o.wg)(),(0,o.iD)("i",w)):(0,o.kq)("",!0),(0,o._)("ul",k,[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:(0,i.iM)((t=>H.deletePost(s)),["prevent"])},"刪除貼文",8,_)])])]),(0,o.Wm)(Z,{to:`/post/${s._id}`,href:"#"},{default:(0,o.w5)((()=>[(0,o._)("div",v,[(0,o._)("div",b,[(0,o._)("div",null,[(0,o._)("div",P,[(0,o._)("h3",D,"["+(0,l.zw)(s.type)+"]",1),(0,o._)("p",y,(0,l.zw)(s.title),1)]),(0,o._)("div",$,[s.content.length>50?((0,o.wg)(),(0,o.iD)("p",x,(0,l.zw)(s.content.substring(0,50))+"...",1)):((0,o.wg)(),(0,o.iD)("p",L,(0,l.zw)(s.content),1))])])]),s.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.image,alt:""},null,8,A)):(0,o.kq)("",!0)]),(0,o._)("div",E,[z,(0,o._)("p",C,(0,l.zw)(s.likes.length),1),V,(0,o._)("p",I,(0,l.zw)(s.comments.length),1)])])),_:2},1032,["to"])])):(0,o.kq)("",!0)],64)))),256)),(0,o._)("div",T,[e.loading&&e.postData.length?((0,o.wg)(),(0,o.iD)("div",q,M)):(0,o.kq)("",!0)])])}var B={props:{postData:{type:Object,default(){return{}}},loading:{type:Boolean}},emits:["get-all-post"],data(){return{propsLoading:!1,fromData:{comment:null},isEdit:!1}},methods:{getAllpost(t,s){this.$emit("get-all-post",t,s)},postComment(t){this.propsLoading=!0;const s=this.fromData;this.axios.post(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`,s).then((()=>{this.getAllpost(),this.fromData.comment=null,this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("傳送失敗")}))},setLike(t){const s=t.likes.find((t=>t.name===this.$store.state.userInfo.name));s?this.clearLike(t):(this.propsLoading=!0,this.axios.post(`https://trend-book-api.herokuapp.com/post/${t._id}/like`).then((()=>{this.getAllpost(),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("按讚失敗")})))},clearLike(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/post/${t._id}/unlike`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("收回失敗")}))},formatDate(t){const s=new Date(t),e=`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()} ${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`;return e},deletePost(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/posts/${t._id}`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},deleteComment(t){this.propsLoading=!0,this.axios.delete(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},updataComment(t){const s={comment:t.comment};this.isEdit=!0,this.axios.patch(`https://trend-book-api.herokuapp.com/posts/${t._id}/comment`,s).then((()=>{this.getAllpost(),this.isEdit=!1})).catch((()=>{this.isEdit=!1,alert("傳送失敗")}))},editComment(t){t.isEdit=!0}},mounted(){}},G=e(3744);const S=(0,G.Z)(B,[["render",Z],["__scopeId","data-v-f4e207c8"]]);var W=S},8079:function(t,s,e){e.r(s),e.d(s,{default:function(){return $}});var o=e(6252),l=e(9963);const i=t=>((0,o.dD)("data-v-d072a508"),t=t(),(0,o.Cn)(),t),a={class:"row"},n={class:"col-xl-8 col-md-12"},r={class:"row"},d={class:"col-xl-6 col-md-12 mb-3"},c=i((()=>(0,o._)("option",{value:""},"最新貼文",-1))),p=i((()=>(0,o._)("option",{value:"asc"},"最舊貼文",-1))),h=[c,p],g={class:"col-xl-6 col-md-12 mb-3"},u={class:"input-group"},m=i((()=>(0,o._)("i",{class:"bi bi-search",style:{"font-size":"1.7rem"}},null,-1))),f=[m],w={class:"col-xl-4 col-md-12"};function k(t,s,e,i,c,p){const m=(0,o.up)("postsCardlView"),k=(0,o.up)("AlertView"),_=(0,o.up)("ItemView");return(0,o.wg)(),(0,o.iD)("div",a,[(0,o._)("div",n,[(0,o._)("div",r,[(0,o._)("div",d,[(0,o.wy)((0,o._)("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":s[0]||(s[0]=t=>c.filter=t),onChange:s[1]||(s[1]=t=>p.getAllPost(c.filter,c.searchPost))},h,544),[[l.bM,c.filter]])]),(0,o._)("div",g,[(0,o._)("div",u,[(0,o.wy)((0,o._)("input",{type:"text",class:"form-control border-0 pt-2 pb-2",placeholder:"搜尋貼文","aria-label":"搜尋貼文","aria-describedby":"button-addon2","onUpdate:modelValue":s[2]||(s[2]=t=>c.searchPost=t),onKeyup:s[3]||(s[3]=(0,l.D2)((t=>p.getAllPost(c.filter,c.searchPost)),["enter"]))},null,544),[[l.nr,c.searchPost]]),(0,o._)("button",{class:"border-0 text-light bg-primary",onClick:s[4]||(s[4]=t=>p.getAllPost(c.filter,c.searchPost))},f)])])]),(0,o.Wm)(m,{postData:c.allPost,loading:c.loading,onGetAllPost:p.getAllPost},null,8,["postData","loading","onGetAllPost"]),c.loading||c.allPost.length?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(k,{key:0,tagText:"目前尚無動態，新增一則貼文吧！"}))]),(0,o._)("div",w,[(0,o.Wm)(_,{modalTitle:"發表貼文",onGetPostData:p.getAllPost},null,8,["onGetPostData"])])])}var _=e(9765),v=e(1158),b=e(8384),P={components:{postsCardlView:_.Z,ItemView:v.Z,AlertView:b.Z},data(){return{name:"TenndView",searchPost:"",filter:"",allPost:[],loading:null,page:2,scrollEvent:null}},methods:{getAllPost(t="-createdAt",s="",e=1,o=!1){if(this.loading)return;this.loading=!0;const l={sort:`?timeSort=${t}`,search:`&q=${s}`,page:`&page=${e}`};this.axios.get(`https://trend-book-api.herokuapp.com/posts${l.sort}${l.search}${l.page}`).then((t=>{if(o){t.data.data.length||window.removeEventListener("scroll",this.scrollEvent),this.page+=1;const s=this.allPost.concat(t.data.data);this.allPost=s}else this.allPost=t.data.data,this.page=2;this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getAllPost")}))},getPost(){this.loading=!0,this.axios.get(`https://trend-book-api.herokuapp.com/posts/${this.$route.params.id}`).then((t=>{this.allPost=t.data.data,this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getAllPost")}))},buildThrottle(){function t(t,s){let e=0;return function(...o){const l=Date.now();l-e>s&&(e=l,t.apply(this,o))}}const s=t(this.getAllPost,1e3);this.scrollEvent=()=>{const t=window.scrollY+window.innerHeight>=document.body.offsetHeight-100;t&&s(this.filter,this.searchPost,this.page,!0)}},buildScrollEvent(){this.buildThrottle(),window.addEventListener("scroll",this.scrollEvent)}},mounted(){this.$route.params.id?this.getPost():this.getAllPost(),this.buildScrollEvent()},beforeUnmount(){window.removeEventListener("scroll",this.scrollEvent)}},D=e(3744);const y=(0,D.Z)(P,[["render",k],["__scopeId","data-v-d072a508"]]);var $=y}}]);
//# sourceMappingURL=766.11c8c9b8.js.map